FROM fitzbc/fat_ubuntu1604:v6

ARG FIRMWARE_PATH
ENV REMOTE_IP=${REMOTE_IP}
ENV REMOTE_PORT=${REMOTE_PORT}
ENV FIRMWARE_PATH=${FIRMWARE_PATH}

ADD ${FIRMWARE_PATH} /firmware-analysis-toolkit/firmware.bin

WORKDIR /firmware-analysis-toolkit/

RUN apt install -y tmux net-tools ssh tcpdump expect

ADD run.sh /firmware-analysis-toolkit/run.sh
ADD expect.sh /firmware-analysis-toolkit/expect.sh

RUN ssh-keygen -b 2048 -f /root/.ssh/id_rsa -t rsa -q -N "" && \
    cp /root/.ssh/id_rsa.pub /root/.ssh/authorized_keys
RUN chmod +x run.sh && chmod +x expect.sh && sed -i 's/input/print/' ./fat.py

RUN mkdir /pcap


EXPOSE 80
ENTRYPOINT ./run.sh 
