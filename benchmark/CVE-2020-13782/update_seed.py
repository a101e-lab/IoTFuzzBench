import requests
import re

def get_new_token(target_ip,target_port):

    burp0_url = "http://192.168.0.1:80/login.cgi"
    burp0_headers = {"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:107.0) Gecko/20100101 Firefox/107.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Content-Type": "application/x-www-form-urlencoded", "Origin": "http://192.168.0.1", "Connection": "close", "Referer": "http://192.168.0.1/index.asp", "Upgrade-Insecure-Requests": "1"}
    #burp0_data = {"html_response_page": "login.asp", "login_name": "YWRtaW4A", "login_pass": '', "graph_id": "d30cb", "alert_id": "0", "log_pass": '', "graph_code": '', "login": "Log In"}, data=burp0_data
    results = requests.post(burp0_url, headers=burp0_headers)

    #results = requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)
    results_str = results.text
    return results_str
    #new_token = results_str[results_str.find('userRpm')-17:results_str.find('userRpm')-1]

    #return new_token

def set_new_token(seed,new_token):
    seed_begin = seed[:seed.find('/')+1]
    seed_end = seed[seed.find('userRpm')-1:]
    updated_seed = seed_begin + new_token + seed_end
    return updated_seed

def update_seed(seed='',target_ip = '192.168.0.1',target_port = 80):
    #no need to update but need to login
    seed=seed
    return seed

if __name__ == '__main__':
    target_ip = '192.168.0.1'
    target_port = 80
    seed = '''POST /portal/__ajax_explorer.sgi?action=umnt&path=path&where=here&en=aaaa HTTP/1.1
Host: 192.168.0.1
User-Agent: Mozilla/5.0 (X11; Linux aarch64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 68
Origin: http://192.168.0.1
Connection: close
Referer: http://192.168.0.1/
Cookie: Authorization=Basic%20YWRtaW46MjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzM%3D; SESSION_ID=2:1598955110:2; uid=ZFaEHWvPKb; PrivateKey=BE92EF6F235196D24907CBEE3556D5ED; PHPSESSID=add8d9579cf7aa1f6d3551f0516c222d

REPORT_METHOD=xml&ACTION=login_plaintext&USER=Admin&PASSWD=&CAPTCHA=


'''
    print(get_new_token(target_ip,target_port))
    #updated_seed = update_seed(seed,target_ip,target_port)
    #print(updated_seed)
